<!doctype html>
<html>
<head>
 <meta charset="utf-8">
 <title>Demo</title>
</head>
<body>
<h1>CORS INDEX</h1>
 <script src="http://code.jquery.com/jquery-2.1.4.js"></script>
 <script>
    var context = {
        host: "https://consultant.cloud.bonitasoft.com/bonita/"
    }
   var formData = {
     username: "fabrice.rosito",
     password: "bpm",
     redirect: false
   };
   $.ajax({
     url: context.host + "loginservice?tenant=208",
     type: "POST",
     data: formData,
     xhrFields: {withCredentials: true},
     success: function(data, textStatus, jqXHR) {
           $.ajax({
             url: context.host + "API/system/session/1",
             type: "GET",
             xhrFields: {withCredentials: true},
             success: function(data, textStatus, jqXHR) {
                   console.log('success getting session');
                   var apiToken = jqXHR.getResponseHeader('X-Bonita-API-Token');
                   console.log('X-Bonita-API-Token: ' + apiToken);
                   var formData = {"title":"Mr","manager_id":"0","job_title":"Chief Executive Officer","lastname":"Jobs","firstname":"Will"};
                   $.ajax({
                         url: context.host + "API/bdm/businessData/com.delivery.bonitasoft.WorkLog?p=0&c=50000&q=findByDates&f=initDate=2016-08-21&f=endDate=2017-01-23",
                         type: "GET",
                         contentType: "application/json",
                         /*passing the X-Bonita-API-Token for the CSRF security filter*/
                         headers: {'X-Bonita-API-Token': apiToken},
                         xhrFields: {withCredentials: true},
                         success: function(data, textStatus, jqXHR) {
                           console.log('get data');
                           console.log(data);
                         },
                         error: function(jqXHR, textStatus, errorThrown) {
                           console.log('error updating user info');
                         }
                   });
             },
             error: function(jqXHR, textStatus, errorThrown) {
               console.log('error getting session');
             }
           });
     },
     error: function(jqXHR, textStatus, errorThrown) {
       console.log('error login');
     }
   });
 </script>
</body>
</html>